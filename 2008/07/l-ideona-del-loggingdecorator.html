<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title></title>

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />

        <link rel="openid.server" href="http://www.blogger.com/openid-server.g" />
        <link rel="openid.delegate" href="http://andreafrancia.blogspot.com/" />

        <link href="/css/layout.css" rel="stylesheet" type="text/css" />
        <link href="/css/code-highlight.css" rel="stylesheet" type="text/css" />

        <link rel="alternate" type="application/rss+xml" title="Feed" href="/atom.xml" />

        <!-- Histats.com  START  --> 
<script async type="text/javascript" language="javascript"> 
var s_sid = 321314;var st_dominio = 4; 
var cimg = 0;var cwi =150;var che =30; 
</script> 
<script  async type="text/javascript" language="javascript" src="http://s11.histats.com/js9.js"/></script> 
<noscript><img src="http://s103.histats.com/stats/0.gif?321314&1" alt="contatore free" border="0"/> 
</noscript> 

<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4316218-1']);
  _gaq.push(['_setDomainName', 'andreafrancia.it']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    </head>
    <body>
        <div id='mainnav' class='nav'>
    <ul>
        <li><a href="/">andreafrancia.it</a>
        <li class="last"><a href="/log.html">blog</a>
    </ul>
</div>

        <div id="contents">
            <h1>L'ideona del loggingDecorator</h1>
<div class='post'>
Oggi ho partorito l'ideona del loggingDecorator.
Anche se sono sicuro che è già venuta a mille altre persone ve la dico lo stesso.

Fate finta che vi serve aggiungere ad ogni metodo dei messaggi di debug del tipo "sono entrato nel metodo", "sto uscendo dal metodo" o simili.

Uno con poca fantasia farebbe così:
<pre name="code" class="java:nogutter">public void someMethod() {
  logger.debug("Begin of someMethod()");

  ... // corpo del metodo

  logger.debug("End of someMethod()");
}
</pre>Io pero' dovevo debbuggare le chiamate a una classe che aveva molti metodi e non volevo usare il copia incolla. Ho preferito scomodare il design pattern decorator e la Java Reflection.

Ho usato:
<pre name="code" class="java:nogutter">    EntityManager em = ...
  em  = LoggingDecorators.loggingDecorator(em, EntityManager.class)
</pre>Avendo definito
<pre name="code" class="java:nogutter">public class LoggingDecorators {
  private static final Logger logger =
          Logger.getLogger(LoggingDecorators.class.getName());

  public static &lt;T&gt; T loggingDecorator(
              final T target,
              final Class&lt;T&gt; targetClass) {
      return (T) Proxy.newProxyInstance(targetClass.getClassLoader(),
              new Class[] { targetClass}, new InvocationHandler() {

          public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
              logger.info("Begin of " + method);
              try {
                  return method.invoke(target, args);
              } catch(InvocationTargetException ex) {
                  throw ex.getCause();
              } finally {
                  logger.info("End of " + method);
              }
          }
      });
  }
}
</pre></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Andrea Francia</div>
<div class='content'>
Hai ragione, c'era un baco nel codice del mio post, adesso l'ho corretto.<BR/><BR/>Il secondo parametro è l'interfaccia che deve implementare il decorator.<BR/><BR/>Comunque trovi un esempio <A HREF="http://code.google.com/p/andreafrancia-util/source/browse/trunk/src/andreafrancia/util/LoggingDecorators.java#48" REL="nofollow">qui</A>, alla riga 48.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Ciao, direi che io stavo cercando qualcosa di simile, ma non ho ben capito come funziona il tuo esempio, ecco alcune delle cose che non ho capito: tu chiami il metodo in questo modo "loggingDecorator(em)" ma quel metodo ha una segnatura diversa; poi come fai a chiamare il metodo originale?<BR/><BR/>Federico</div>
</div>
</div>

        </div>
        <!-- Histats.com  START  --> 
<script async type="text/javascript" language="javascript"> 
var s_sid = 321314;var st_dominio = 4; 
var cimg = 0;var cwi =150;var che =30; 
</script> 
<script  async type="text/javascript" language="javascript" src="http://s11.histats.com/js9.js"/></script> 
<noscript><img src="http://s103.histats.com/stats/0.gif?321314&1" alt="contatore free" border="0"/> 
</noscript> 

<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4316218-1']);
  _gaq.push(['_setDomainName', 'andreafrancia.it']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    </body>
</html>
