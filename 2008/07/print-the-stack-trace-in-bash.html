<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title></title>

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />

        <link rel="openid.server" href="http://www.blogger.com/openid-server.g" />
        <link rel="openid.delegate" href="http://andreafrancia.blogspot.com/" />

        <link href="/css/layout.css" rel="stylesheet" type="text/css" />
        <link href="/css/code-highlight.css" rel="stylesheet" type="text/css" />

        <link rel="alternate" type="application/rss+xml" title="Feed" href="/atom.xml" />

        <!-- Histats.com  START  --> 
<script async type="text/javascript" language="javascript"> 
var s_sid = 321314;var st_dominio = 4; 
var cimg = 0;var cwi =150;var che =30; 
</script> 
<script  async type="text/javascript" language="javascript" src="http://s11.histats.com/js9.js"/></script> 
<noscript><img src="http://s103.histats.com/stats/0.gif?321314&1" alt="contatore free" border="0"/> 
</noscript> 

<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4316218-1']);
  _gaq.push(['_setDomainName', 'andreafrancia.it']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    </head>
    <body>
        <div id='mainnav' class='nav'>
    <ul>
        <li><a href="/">andreafrancia.it</a>
        <li><a href="/log.html">log</a>
        <li><a href="/resume.html">cv</a></li>
        <li><a href='/talks.html'>speaking</a>
        <li><a href="/code.html">coding</a></li>
        <li class="last"><a href="/library.html">reading</a></li>
    </ul>
</div>

        <div id="contents">
            <h1>Print the stack trace in bash</h1>
<p>Ieri ho partorito una semplice funzione che trovo molto comoda per debuggare gli scritp shell, si chiama print_stack_trace.</p>

<p>print_stack_trace andrebbe invocata quando si incontra una condizione di errore e si vuole risalire a qual&#8217;e&#8217; stato il flusso delle chiamate che l&#8217;ha provocata.</p>

<p>Un esempio di utilizzo è il seguente::</p>
<div class='code'>

<div class='highlight'><pre><code class='bash'>save_to_file<span class='o'>()</span> <span class='o'>{</span>
    <span class='nb'>local </span><span class='nv'>filename</span><span class='o'>=</span><span class='s2'>&quot;$1&quot;</span>

    <span class='k'>if</span> <span class='o'>[[</span> -e <span class='nv'>$filename</span> <span class='o'>]]</span>; <span class='k'>then</span>
<span class='k'>        </span><span class='nb'>echo</span> <span class='s2'>&quot;File already exists: $filename&quot;</span> &gt;2
        print_stack_trace
        <span class='nb'>exit </span>1
    <span class='k'>fi</span>

    ... <span class='c'># scrittura su file</span>
<span class='o'>}</span>
</code></pre></div>

</div>
<p>Quando per qualsiasi motivo la funzione save_to_file() è invocata con un argomento non valido stampa un messaggio di errore seguito dall&#8217;elenco delle chiamate a funzione che hanno portato all&#8217;errore. Per esempio:</p>
<pre class='terminal'>
File already exists: test-file
Stack trace:
 save_to_file(./print-stack-trace.bash:13)
 function_three(./print-stack-trace.bash:22)
 function_two(./print-stack-trace.bash:26)
 function_one(./print-stack-trace.bash:30)
 main(./print-stack-trace.bash:33)
</pre>
<p>La funzione print_stack_trace è la seguente:</p>
<div class='code'>

<div class='highlight'><pre><code class='bash'><span class='c'># print_stack_trace: print the stack trace in bash</span>
print_stack_trace<span class='o'>()</span> <span class='o'>{</span>
    <span class='nb'>echo</span> <span class='s2'>&quot;Stack trace:&quot;</span>
    <span class='k'>for</span> <span class='o'>((</span> <span class='nv'>i</span><span class='o'>=</span>1; i&lt;<span class='k'>${#</span><span class='nv'>FUNCNAME</span><span class='p'>[@]</span><span class='k'>}</span>; i++<span class='o'>))</span>; <span class='k'>do</span>
<span class='k'>        </span><span class='nb'>echo</span> <span class='s2'>&quot; ${FUNCNAME[$i]}(${BASH_SOURCE[$i]}:${BASH_LINENO[$i-1]})&quot;</span>
    <span class='k'>done</span>
<span class='o'>}</span> 
</code></pre></div>

</div>
        </div>
        <!-- Histats.com  START  --> 
<script async type="text/javascript" language="javascript"> 
var s_sid = 321314;var st_dominio = 4; 
var cimg = 0;var cwi =150;var che =30; 
</script> 
<script  async type="text/javascript" language="javascript" src="http://s11.histats.com/js9.js"/></script> 
<noscript><img src="http://s103.histats.com/stats/0.gif?321314&1" alt="contatore free" border="0"/> 
</noscript> 

<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4316218-1']);
  _gaq.push(['_setDomainName', 'andreafrancia.it']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    </body>
</html>
